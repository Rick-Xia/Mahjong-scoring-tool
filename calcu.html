<!DOCTYPE html>
<html>
<head>
	<title>calculation page</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
	body {
		# text-align: center;
		background-color: #F7F9F9;
	}
	ul {
    	list-style-type: none;
    	overflow: hidden;
	}
	li {
    	float: left;
	}
	button img {
		width: 44px;
		height: 53px;
	}
	</style>

	<script type="text/javascript">
		var indexId = 0; // id for tiles
		var num = 0; // count of tiles in hand
		var cur = 0;
		var sublistId = 0;
		var numOpen = 0;

		function alertTooManyTile() {
			document.getElementById("msg").innerHTML = "too many tiles in hand! Maximum is 13(hand) + 1(wait)";
		}

		function alertTooManyOpen() {
			document.getElementById("msg").innerHTML = "too many opens! Maximum is 4";
		}

		function refreshMsg() {
			document.getElementById("msg").innerHTML = "";
		}

		function refreshResult() {
			document.getElementById("result").innerHTML = "";
		}

		function clearAll() {
			var hand = document.getElementById("hand"),
				open = document.getElementById("open"),
				wait = document.getElementById("wait");
			while ( hand.firstChild ) {
				hand.removeChild(hand.firstChild);
				num--;
			}
			while ( open.firstChild ) {
				open.removeChild(open.firstChild);
			}
			while ( wait.firstChild ) {
				wait.removeChild(wait.firstChild);
			}
			refreshMsg();
			return refreshResult();
		}

		function calc() {


			var ret = document.getElementById("result");
			ret.innerHTML = "0";
		}

		function add(name) {

			if ( num >= 13 )  return alertTooManyTile();

			var buttonTemp = buttonCreate(name);
			buttonTemp.id = indexId;
			var currentPlace = cur;
			buttonTemp.onclick = function () {
				remove(buttonTemp.id, currentPlace);
			};

			if ( cur.id == "wait" && cur.firstChild != null ) {
				cur.replaceChild(buttonTemp, cur.firstChild);
				return;
			}

			cur.appendChild(buttonTemp);

			if ( cur.id == "hand" ) {
				indexId++;
				num++;
			}
		}

		function remove(id, place) {
			var element = document.getElementById(id);
			place.removeChild(element);
			num--;
			return refreshMsg();
		}

		function buttonCreate(name) {
			var button = document.createElement("button");
			button.type = "button";
			button.name = name;
			button.onclick = function () {
				add(button.name);
			};

			button.innerHTML = '<img src="img/' + button.name + '.png" />';
			return button;
		}

		function tileGenerate(type) {
			var list = document.getElementById(type), count = 1;

			while ( count <= 9 ) {
				var button = buttonCreate(count + type);
				var sublist = document.createElement("li");
				sublist.appendChild(button);

				list.appendChild(sublist);
				count++;
			}
		}

		function deleteOpen(id) {
			var open = document.getElementById("open");
			var child = document.getElementById(id);
			open.removeChild(child);
			numOpen--;
			return refreshMsg();
		}

		function addOpen() {
			if ( numOpen >= 4 ) return alertTooManyOpen();

			changeCur("open");
			var list = document.createElement("ul");
			list.id = "openlist" + sublistId;

			var sublFn = document.createElement("li");
			var sublTile = document.createElement("li");
			sublTile.id = "sublist" + sublistId;

			var buttonDel= document.createElement("button");
			buttonDel.type = "button";
			buttonDel.innerHTML = "Delete";
			buttonDel.onclick = function () {
				deleteOpen(list.id);
			};
			sublFn.appendChild(buttonDel);

			var buttonSel = document.createElement("button");
			buttonSel.type = "button";
			buttonSel.innerHTML = "Select";
			buttonSel.onclick = function () {
				changeCur(sublTile.id);
			};
			sublFn.appendChild(buttonSel);
			
			list.appendChild(sublFn);
			list.appendChild(sublTile);
			cur.appendChild(list);

			sublistId++;
			numOpen++;
			changeCur(sublTile.id);
		}

		function changeCur(id) {
			cur = document.getElementById(id);
			console.log("cur is " + id);
		}

	</script>
</head>

<body>

	<a href="index.html">back to main page</a>
	<br />

	<div style="margin:20px">
		<ul id="p"></ul>
		<ul id="s"></ul>
		<ul id="m"></ul>

		<script type="text/javascript">tileGenerate("p");</script>
		<script type="text/javascript">tileGenerate("s");</script>
		<script type="text/javascript">tileGenerate("m");</script>
		
	</div>

	<div>
		<p>Hand: <button type="button" onclick="changeCur('hand')">SELECT</button><span id="hand"></span></p>
		<p>Wait: <button type="button" onclick="changeCur('wait')">SELECT</button><span id="wait"></span></p>
		<p>Open: <button type="button" onclick="addOpen()">Add an open</button>
			<span id="open"></span></p>
		<p>message: <span id="msg"></span></p>
		<button type="button" onclick="calc()">Calculate!</button>
		<p>result: <span id="result"></span></p>
		<button type="button" onclick="clearAll()">Clear all</button>
	</div>

	<script type="text/javascript">
		cur = document.getElementById("hand");
	</script>

</body>


</html>
