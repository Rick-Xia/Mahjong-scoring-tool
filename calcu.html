<!DOCTYPE html>
<html>
<head>
	<title>calculation page</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
	body {
		# text-align: center;
		background-color: #F7F9F9;
	}
	ul {
    	list-style-type: none;
    	overflow: hidden;
	}
	li {
    	float: left;
	}
	button img {
		width: 44px;
		height: 53px;
	}
	</style>

	<script type="text/javascript">
		var indexId = 0; // id for tiles
		var num = 0; // count of tiles in hand
		var cur = 0;
		var sublistId = 0;
		var numOpen = 0;
		var tilePlaces = ["hand", "wait", "open", "zwind", "cwind"];

		function alertTooManyTile() {
			document.getElementById("msg").innerHTML = "too many tiles in hand! Maximum is 13(hand+open) + 1(wait)";
		}

		function alertTooManyOpen() {
			document.getElementById("msg").innerHTML = "too many opens! Maximum is 4";
		}

		function alertTooManyTileForAnOpen() {
			document.getElementById("msg").innerHTML = "To add an open, there should be at least 3 tiles free. Now you have " + (13 - num) + " free";
		}

		function refreshMsg() {
			document.getElementById("msg").innerHTML = "";
		}

		function refreshResult() {
			document.getElementById("result").innerHTML = "";
		}

		function clearAll() {
			var plen = tilePlaces.length;

			for (i = 0; i < plen; ++i) {
				var place = document.getElementById(tilePlaces[i]);
				while ( place.firstChild ) 
					place.removeChild(place.firstChild);
			}
			num = 0;
			numOpen = 0;
			changeCur("hand");

			refreshMsg();
			return refreshResult();
		}

		function calc() {
			var ret = document.getElementById("result"), val = 0;
			ret.innerHTML = val;
		}

		function add(name) {
			if ( cur.id == "hand" && num >= 13 )  return alertTooManyTile();
			refreshMsg();

			var buttonTemp = buttonCreate(name);
			buttonTemp.id = indexId++;
			var currentPlace = cur;
			buttonTemp.onclick = function () {
				remove(buttonTemp.id, currentPlace);
			};

			if ( (cur.id == "wait" || cur.id == "cwind" || cur.id == "zwind") && cur.firstChild != null ) {
				cur.replaceChild(buttonTemp, cur.firstChild);
				return;
			}

			cur.appendChild(buttonTemp);

			if ( cur.id == "hand" ) num++;
		}

		function remove(id, place) {
			var element = document.getElementById(id);
			place.removeChild(element);
			num--;
			return refreshMsg();
		}

		function buttonCreate(name) {
			var button = document.createElement("button");
			button.type = "button";
			button.name = name;
			button.onclick = function () {
				add(button.name);
			};

			button.innerHTML = '<img src="img/' + button.name + '.png" />';
			return button;
		}

		function tileGenerate(type) {
			var list = document.getElementById(type), count = 1, max = 0;
			switch (type) {
				case "m":
				case "s":
				case "p":
					max = 9;
					break;
				case "f":
					max = 4;
					break;
				case "g":
					max = 3;
					break;
			}

			while ( count <= max ) {
				var button = buttonCreate(count + type);
				var sublist = document.createElement("li");
				sublist.appendChild(button);

				list.appendChild(sublist);
				count++;
			}
		}

		function deleteOpen(id) {
			var open = document.getElementById("open");
			var child = document.getElementById(id);
			open.removeChild(child);
			numOpen--;
			num -= 3;
			return refreshMsg();
		}

		function addOpen() {
			if ( numOpen >= 4 ) return alertTooManyOpen();
			if ( num >= 10 ) return alertTooManyTileForAnOpen();

			changeCur("open");
			var list = document.createElement("ul");
			list.id = "openlist" + sublistId;

			var sublFn = document.createElement("li");
			var sublTile = document.createElement("li");
			sublTile.id = "sublist" + sublistId;

			var buttonDel= document.createElement("button");
			buttonDel.type = "button";
			buttonDel.innerHTML = "Delete";
			buttonDel.onclick = function () {
				deleteOpen(list.id);
			};
			sublFn.appendChild(buttonDel);

			var buttonSel = document.createElement("button");
			buttonSel.type = "button";
			buttonSel.innerHTML = "Select";
			buttonSel.onclick = function () {
				changeCur(sublTile.id);
			};
			sublFn.appendChild(buttonSel);
			
			list.appendChild(sublFn);
			list.appendChild(sublTile);
			cur.appendChild(list);

			sublistId++;
			numOpen++;
			num += 3;
			changeCur(sublTile.id);
		}

		function changeCur(id) {
			cur = document.getElementById(id);
		}

	</script>
</head>

<body>

	<a href="index.html">back to main page</a>
	<br />

	<div style="margin:20px">
		<ul id="p"></ul>
		<ul id="s"></ul>
		<ul id="m"></ul>
		<ul id="f"></ul>
		<ul id="g"></ul>

		<script type="text/javascript">tileGenerate("p");</script>
		<script type="text/javascript">tileGenerate("s");</script>
		<script type="text/javascript">tileGenerate("m");</script>
		<script type="text/javascript">tileGenerate("f");</script>
		<script type="text/javascript">tileGenerate("g");</script>
		
	</div>

	<div>
		<p>Hand: <button type="button" onclick="changeCur('hand')">SELECT</button><span id="hand"></span></p>
		<p>Wait: <button type="button" onclick="changeCur('wait')">SELECT</button><span id="wait"></span></p>
		<p>Open: <button type="button" onclick="addOpen()">Add an open</button>
			<span id="open"></span></p>

		<p>Prevailing wind: <button type="button" onclick="changeCur('cwind')">SELECT</button><span id="cwind"></span></p>
		<p>Player's wind: <button type="button" onclick="changeCur('zwind')">SELECT</button><span id="zwind"></span></p>

		<button type="button" onclick="calc()">Calculate!</button>
		<button type="button" onclick="clearAll()">Clear all</button>
			
		<p>result: <span id="result"></span></p>
		<p>message: <span id="msg"></span></p>
	</div>

	<script type="text/javascript">
		cur = document.getElementById("hand");
	</script>

</body>


</html>
